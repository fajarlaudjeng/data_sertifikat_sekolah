<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Sertifikat Satuan Pendidikan</title>

<!-- Bootstrap -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<!-- Tailwind -->
<script src="https://cdn.tailwindcss.com"></script>

<style>
iframe { width:100%; height:480px; border:none; }
.header-logo { height:75px; }
.spinner {
    border: 4px solid #f3f3f3;
    border-top: 4px solid #0d6efd;
    border-radius: 50%;
    width: 36px;
    height: 36px;
    animation: spin 1s linear infinite;
    margin: auto;
}
@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}
.carousel-inner img { max-height: 300px; object-fit: contain; }
</style>
</head>

<body class="bg-gray-100">

<div class="container my-4 max-w-5xl">

<!-- HEADER -->
<div class="card shadow p-3 mb-4">
    <div class="row align-items-center text-center">
        <div class="col-3 text-start">
            <img src="assets/images/logo_kabupaten.png" class="header-logo">
        </div>
        <div class="col-6">
            <h6 class="fw-bold mb-1">PEMERINTAH KABUPATEN DONGGALA</h6>
            <h6 class="fw-bold mb-1">DINAS PENDIDIKAN DAN KEBUDAYAAN</h6>
            <small>Jalan Jati Nomor ....</small>
        </div>
        <div class="col-3 text-end">
            <img src="assets/images/logo_kemdikbud.png" class="header-logo">
        </div>
    </div>
</div>

<!-- CONTENT -->
<div class="card shadow-lg p-4">
    <div class="row align-items-start">

        <!-- LEFT -->
        <div class="col-md-8 col-12">
            <h4 class="text-center mb-3 fw-bold">Cek Sertifikat Sekolah</h4>

            <input type="text" id="npsn" class="form-control mb-2" placeholder="Masukkan NPSN">
            <button onclick="login()" class="btn btn-primary w-100 mb-3">
                Cek Sertifikat
            </button>

            <div id="hasil"></div>
        </div>

        <!-- RIGHT IMAGE -->
        <div class="col-md-4 col-12 text-center mt-4 mt-md-0">
            <img src="assets/images/kantor_bupati.jpg" class="img-fluid rounded shadow-sm" style="max-height:240px" alt="Gambar Kantor Bupati">
            <p class="text-sm text-gray-500 mt-2">
                Sistem Informasi Sertifikat<br>
                Satuan Pendidikan
            </p>
        </div>

    </div>
</div>

<!-- FOOTER -->
<div class="text-center mt-4 text-sm text-gray-600">
    <hr>
    <p class="fw-semibold mt-2">
        Badan Pengelolaan Keuangan dan Aset Daerah<br>
        Bidang Aset Daerah
    </p>
</div>

</div>

<script>
// Database lokal ‚Üí fetch JSON
let database = [];

fetch('assets/database.json')
  .then(res => res.json())
  .then(data => {
    database = data;
    console.log('Database loaded:', database);
  })
  .catch(err => console.error('Gagal load database:', err));

// Fungsi cek NPSN
function login() {
    const npsnInput = document.getElementById("npsn").value.trim();
    const hasil = document.getElementById("hasil");

    if(!/^\d{8}$/.test(npsnInput)){
        hasil.innerHTML = `<div class="alert alert-warning">NPSN harus 8 digit angka.</div>`;
        return;
    }

    hasil.innerHTML = `<div class="spinner mt-3"></div>`;

    setTimeout(()=>{ // simulasi loading
        const row = database.find(d => d.npsn === npsnInput);
        if(!row){
            hasil.innerHTML = `<div class="alert alert-danger">NPSN tidak ditemukan</div>`;
            return;
        }

        hasil.innerHTML = `
        <div class="table-responsive mt-3">
        <table class="table table-bordered">
            <tr><th>Nama Sekolah</th><td>${row.nama}</td></tr>
            <tr><th>Alamat</th><td>${row.alamat}, ${row.kecamatan}, ${row.kabupaten}</td></tr>
            <tr><th>Status</th><td>${row.status}</td></tr>
            <tr><th>Sertifikat</th><td>${btnPreview(row.sertifikat)}</td></tr>
            <tr><th>Rumah Dinas Guru</th><td>${btnPreview(row.rumah_dinas)}</td></tr>
            <tr><th>Gambar</th><td>${carouselImages(row.gambar)}</td></tr>
            <tr><th>Koordinat</th><td>${row.latitude && row.longitude ? `<button class="btn btn-info btn-sm" onclick="lihatPeta(${row.latitude},${row.longitude})">üìç Lihat Peta</button>` : "-"}</td></tr>
        </table>
        </div>
        <div id="preview" class="mt-3"></div>
        `;
    }, 500);
}

// Tombol preview PDF
function btnPreview(link){
    if(link){
        return `<button class="btn btn-success btn-sm" onclick="preview('${link}')">üëÅ Lihat PDF</button>`;
    }
    return "-";
}

// Carousel untuk preview gambar
function carouselImages(links){
    if(!links || links.length === 0) return "-";

    let indicators = '';
    let inner = '';
    links.forEach((link,i)=>{
        indicators += `<button type="button" data-bs-target="#carouselPreview" data-bs-slide-to="${i}" ${i===0?'class="active" aria-current="true"':''} aria-label="Slide ${i+1}"></button>`;
        inner += `
        <div class="carousel-item ${i===0?'active':''}">
            <img src="${link}" class="d-block w-100" alt="Preview Gambar">
            <a href="${link}" target="_blank" class="btn btn-warning btn-sm mt-2 w-100">‚¨áÔ∏è Download</a>
        </div>
        `;
    });

    return `
    <div id="carouselPreview" class="carousel slide" data-bs-ride="carousel">
        <div class="carousel-indicators">${indicators}</div>
        <div class="carousel-inner">${inner}</div>
        <button class="carousel-control-prev" type="button" data-bs-target="#carouselPreview" data-bs-slide="prev">
            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
            <span class="visually-hidden">Previous</span>
        </button>
        <button class="carousel-control-next" type="button" data-bs-target="#carouselPreview" data-bs-slide="next">
            <span class="carousel-control-next-icon" aria-hidden="true"></span>
            <span class="visually-hidden">Next</span>
        </button>
    </div>
    `;
}

// Preview PDF
function preview(link){
    document.getElementById("preview").innerHTML = `
    <div class="card p-3">
        <iframe src="${link}"></iframe>
        <a href="${link}" target="_blank" class="btn btn-warning mt-2 w-100">‚¨áÔ∏è Download</a>
    </div>
    `;
}

// Google Maps
function lihatPeta(lat, lng){
    const url = `https://www.google.com/maps?q=${lat},${lng}&z=18`;
    window.open(url, "_blank");
}
</script>

</body>
</html>
